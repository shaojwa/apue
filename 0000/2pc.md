两阶段提交是分布式系统的一个非常常见的说法，那么它到底是什么意思？是为了解决什么问题？

我所理解的两阶段提交，就是将一个分布式事务，通过两个步骤来实现来保证分布式原子性。其实这是一种很自然的想法。
分布式系统所面临的一大问题就是一致性，一个事务需要在多个节点上执行，只有所有的节点都执行成功，我们才能认为这个事务完成。
如果一个节点失败，那么其他节点必须要回退，这样才能保证分布式事务的原子性。分布式事务的原子性直接决定分布式系统的数据一致性。

为什么需要两阶段提交？因为分布式，分布式直接导致了两阶段。我们需要保证所有节点的行为是一致的，要么提交，要么放弃（回退）。
所以要讨论2pc，一定是在分布式系统中的，也一定是为了保证事务的原子才需要讨论PC。

那是哪两个阶段呢？一个是分布式submit（发送）阶段，或者说投票阶段，等待所有的节点告诉我结果，协调者才知道我这个事务能否提交。
当所有的参与者（Participants）都返回成功之后，协调者（Coordinator）再发出commit请求，表示事务完成，或者发送rollback表示需要回退。

注意这个commit或者rollback也是分布式的，协调者会通知所有的参与者，要不要提交这个请求。
如果之前所有的参与者都返回成功，协调者才可以给所有的参与者发送命令，告诉所有参与者进行提交，否者就中止。

#### 2PC的前提
从上面描述我们知道，2PC如果想要运行成功，是有前提条件的：
（1）要有超时，协调者发送的请求，如果有的参与者没有返回，那么不能因此而长时间阻塞，所以些调者需要有超时。
（2）不能有任何节点一直处于故障。如果有节点一直故障，协调者通知所有节点rollback，此时是需要等待所有参与者反馈的。

所以，这已经是两个很强的条件。及时如此，2pc的效率还是很低，或者说可以优化，实际实现中，通过增加一些天梯条件，可以对2pc进行优化，提高性能。
